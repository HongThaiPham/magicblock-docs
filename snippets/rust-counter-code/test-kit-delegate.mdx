```typescript kit
// "Delegate" transaction

// Add local validator identity to the remaining accounts if running on localnet
const remainingAccounts =
  connection.clusterUrlHttp.includes("localhost") ||
  connection.clusterUrlHttp.includes("127.0.0.1")
    ? [
        {
          address: address("mAGicPQYBMvcYveUZA5F5UNNwyHvfYh5xkLS2Fr1mev"),
          role: AccountRole.READONLY,
        },
      ]
    : [];
const accounts = [
  { address: userPubkey, role: AccountRole.WRITABLE_SIGNER },
  { address: SYSTEM_PROGRAM_ADDRESS, role: AccountRole.READONLY },
  { address: counterPda, role: AccountRole.WRITABLE },
  { address: PROGRAM_ID, role: AccountRole.READONLY },
  {
    address: await delegateBufferPdaFromDelegatedAccountAndOwnerProgram(
      counterPda,
      PROGRAM_ID
    ),
    role: AccountRole.WRITABLE,
  },
  {
    address: await delegationRecordPdaFromDelegatedAccount(counterPda),
    role: AccountRole.WRITABLE,
  },
  {
    address: await delegationMetadataPdaFromDelegatedAccount(counterPda),
    role: AccountRole.WRITABLE,
  },
  { address: DELEGATION_PROGRAM_ID, role: AccountRole.READONLY },
  ...remainingAccounts,
];
const serializedInstructionData = Buffer.from(
  CounterInstruction.Delegate,
  "hex"
);
const delegateIx: Instruction = {
  accounts,
  programAddress: PROGRAM_ID,
  data: serializedInstructionData,
};
const transactionMessage = pipe(
  createTransactionMessage({ version: 0 }),
  (tx) => setTransactionMessageFeePayer(userPubkey, tx),
  (tx) => appendTransactionMessageInstructions([delegateIx], tx)
);

// Send and confirm transaction on base layer
const txHash = await connection.sendAndConfirmTransaction(
  transactionMessage,
  [userKeypair],
  { commitment: "confirmed", skipPreflight: true }
);
```
